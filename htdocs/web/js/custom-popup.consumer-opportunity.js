function get_detail_consumer_opportunity_by_key(key) {
    var ret = {};
    switch (key) {
        case 'human_authenticity':
            ret['title'] = 'HUMAN AUTHENTICITY';
            ret['text-center'] = 'From innovative <span>activations telling stories about our savoir-faire,<br>roots and people</span>, to new <span>incremental products with craft feel</span>,<br>to <span>new brands embodied by an entrepreneur…</span>';
            ret['block-left-1'] = 'Build future roots & craft';
            ret['block-left-2'] = 'Connect with real people behind products';
            ret['block-opportunityoutlook-1-title'] = 'Ceramic craft innovation revival';
            ret['block-opportunityoutlook-2-title'] = 'Distillery Botanica – Garden grown Gin';
            ret['block-opportunityoutlook-3-title'] = 'In China, villagers age alcohol in bamboo for a new flavour';
            ret['citation'] = '“In a commoditized world,<br>I want a human touch. I prefer human authenticity over branded perfection.”';
            ret['block-business-1-text'] = 'Mature';
            ret['block-business-2-text'] = 'Large size';
            ret['block-business-3-text'] = 'Global geography';
            ret['link_trend_galaxy'] = 'https://trendgalaxy.pernod-ricard.com/desktop/#tr=247';
            return ret;
        case 'easy_at_home_everywhere':
            ret['title'] = 'EASY AT HOME & EVERYWHERE';
            ret['text-center'] = 'From <span>free parties offered by brands,</span> to <span>incremental convenient products</span> <br>(ie RTD), to <span>new services sold to consumers</span> <br>(ie delivery at home, bartender at home)…';
            ret['block-left-1'] = 'Bring to Life memorable experiences at Home';
            ret['block-left-2'] = 'At home on-demand';
            ret['block-opportunityoutlook-1-title'] = 'Efiester facilitates party organisation';
            ret['block-opportunityoutlook-2-title'] = 'Stem makes the at-home cocktail experience easier and practical';
            ret['block-opportunityoutlook-3-title'] = 'DIY Mixology: Frozen Formats';
            ret['citation'] = '“I want experiences that combine the best of a night out with the intimacy of my own home”';
            ret['block-business-1-text'] = 'Emerging';
            ret['block-business-2-text'] = 'Medium size';
            ret['block-business-3-text'] = 'Global geography';
            ret['link_trend_galaxy'] = 'https://trendgalaxy.pernod-ricard.com/desktop/#tr=249';
            return ret;
        case 'shaking_the_codes':
            ret['title'] = 'SHAKING THE CODES';
            ret['text-center'] = 'From <span>limited editions that refresh our brand activations,</span> to innovations <span>that invite consumers to a new take on something familiar</span> (ie discover more accessible recipes, new ageing methods), to <span>ones that will set new rules for the category…</span>';
            ret['block-left-1'] = 'Give a new take on something familiar';
            ret['block-left-2'] = 'Offer new tastes discovery and<br>multi-sensorial experiences';
            ret['block-opportunityoutlook-1-title'] = 'Granny Gothard’s Alcoholic ice-pop sorbets';
            ret['block-opportunityoutlook-2-title'] = 'Keurig-friendly cannabis coffee pods';
            ret['block-opportunityoutlook-3-title'] = 'Kille Enna sprayed cordials';
            ret['citation'] = '“To break from the everyday,<br>I want to escape, to be surprised by new sensory adventures. I expect my favorite brands to stimulate discovery out of familiar products”';
            ret['block-business-1-text'] = 'Developing';
            ret['block-business-2-text'] = 'Large size';
            ret['block-business-3-text'] = 'Global geography';
            ret['link_trend_galaxy'] = 'https://trendgalaxy.pernod-ricard.com/desktop/#tr=250';
            return ret;
        case 'power_to_consumers':
            ret['title'] = 'POWER TO CONSUMERS';
            ret['text-center'] = 'From <span>disruptive brand mentoring activations,</span> to innovations<br><span>ranging from standardized personalization</span> (ie flavors), to <span>customization<br>and even co-creation</span> (ie blending)…';
            ret['block-left-1'] = 'Contribute, not just consume';
            ret['block-left-2'] = 'Creative collectives';
            ret['block-opportunityoutlook-1-title'] = 'Accorhotels’ Jo&Joe new co-living Hostel concept';
            ret['block-opportunityoutlook-2-title'] = 'Lynk & co – A car developed to be shared';
            ret['block-opportunityoutlook-3-title'] = 'Jack Daniel’s Crowd Sourced Bar in Australia';
            ret['citation'] = '“If I cannot get what I need from traditional institutions, I’m confident I can band with some peers to create what we need.”';
            ret['block-business-1-text'] = 'Developing';
            ret['block-business-2-text'] = 'Medium size';
            ret['block-business-3-text'] = 'Global geography';
            ret['link_trend_galaxy'] = 'https://trendgalaxy.pernod-ricard.com/desktop/#tr=251';
            return ret;
        case 'feminine_identity':
            ret['title'] = 'FEMININE IDENTITY';
            ret['text-center'] = 'From innovative <span>activations that portrait today’s women stories,</span><br>to innovations <span>created by women for women…</span>';
            ret['block-left-1'] = 'Recognize female needs beyond clichés';
            ret['block-left-2'] = false;
            ret['block-opportunityoutlook-1-title'] = 'Nike India celebrates female empowerment';
            ret['block-opportunityoutlook-2-title'] = 'Armani “SÌ WOMEN’S CIRCLE”';
            ret['block-opportunityoutlook-3-title'] = 'Baileys sisterhood campaign in China';
            ret['citation'] = '“As a women,<br>I want products like me,<br>not girly clichés.”';
            ret['block-business-1-text'] = 'Developing';
            ret['block-business-2-text'] = 'Medium size';
            ret['block-business-3-text'] = 'Global geography';
            ret['link_trend_galaxy'] = 'https://trendgalaxy.pernod-ricard.com/desktop/#tr=252';
            return ret;
        case 'doing_good':
            ret['title'] = 'DOING GOOD';
            ret['text-center'] = 'From innovative <span>activations where brands give back funding to environmental and social causes,</span> to <span>fair trade limited editions,</span> to innovations <span>with eco-friendly or social impact embedded into our way of doing business…</span>';
            ret['block-left-1'] = 'Longview consumption';
            ret['block-left-2'] = 'Make a positive societal impact';
            ret['block-opportunityoutlook-1-title'] = 'P&G fully recycled shampoo bottle made from beach plastic';
            ret['block-opportunityoutlook-2-title'] = 'Patagonia wear it again buy-back programme';
            ret['block-opportunityoutlook-3-title'] = 'Tito\'s donates online sales to charity ‘indefinitely’';
            ret['citation'] = '“I’m concerned about the negative human impact on environment and for certain communities ; I adapt the way I consume and the brand<br>I choose to balance that.”';
            ret['block-business-1-text'] = 'Developing';
            ret['block-business-2-text'] = 'Large size';
            ret['block-business-3-text'] = 'Global geography';
            ret['link_trend_galaxy'] = 'https://trendgalaxy.pernod-ricard.com/desktop/#tr=248';
            return ret;
        case 'better_for_me':
            ret['title'] = 'BETTER FOR ME';
            ret['text-center'] = 'From <span>CSR innovative activations</span> to innovations <span><br>around products with natural ingredients, less conservatives,<br>fruit extracts, and low ABV alcohol – or even no alcohol…</span>';
            ret['block-left-1'] = 'Healthy Hedonism';
            ret['block-left-2'] = 'Self-optimisation';
            ret['block-opportunityoutlook-1-title'] = 'The museum workout at  The Met';
            ret['block-opportunityoutlook-2-title'] = 'Coca Cola’s farmsquare helps people find healthy food';
            ret['block-opportunityoutlook-3-title'] = ' Seedlip – A distilled non-alcoholic spirit';
            ret['citation'] = '“I want to take pleasure in life, and at the same time feel and show to my friends I’m healthy ; food and drinks play a key role in my lifestyle.”';
            ret['block-business-1-text'] = 'Mature';
            ret['block-business-2-text'] = 'Medium size';
            ret['block-business-3-text'] = 'Developed markets';
            ret['link_trend_galaxy'] = 'https://trendgalaxy.pernod-ricard.com/desktop/#tr=253';
            return ret;
        default:
            return false;
    }
}

function consumerOpportunityStep0Html() {
    var out = [], o = -1;
    out[++o] = '<div class="padding-30 padding-top-0 central-content-846">';
    out[++o] = '<div class="consumer_opportunity_step overflow-hidden">';
    out[++o] = '<div class="column-percent-50 padding-right-20">'; // Start column left
    out[++o] = '<img class="img-100" src="/images/coop/coop-step-0.png"/>';
    out[++o] = '</div>'; // End column left
    out[++o] = '<div class="column-percent-50 padding-left-20">'; // Start column right
    out[++o] = '<div class="font-montserrat-700 margin-bottom-30 font-size-20">';
    out[++o] = 'Innovation is all about being specific and making choices, because ONE SIZE FITS NONE.';
    out[++o] = '</div>';
    out[++o] = '<div class="font-work-sans-300 font-size-15">';
    out[++o] = 'Your innovation might have many qualities, but it will be bought for <span class="font-work-sans-600">one main feature.</span>.<br><br>';
    out[++o] = 'That feature will drive your route to market choices, your sales pitch, your communication assets. So the clearer your are, the clearer it will be for markets, sales team, customers and ultimately consumers.';
    out[++o] = '</div>';
    out[++o] = '</div>'; // End column right
    out[++o] = '</div>';
    out[++o] = '<div class="content-buttons">';
    out[++o] = '<button class="hub-button yellow consumer_opportunity_action_begin">Let’s do this!</button>';
    out[++o] = '</div>';
    out[++o] = '</div>';

    return out.join('');
}

function consumerOpportunityFantasticStepHtml(selectable_values) {
    var out = [], o = -1;
    out[++o] = '<div class="padding-30 padding-top-0 central-content-846">';
    out[++o] = '<div class="consumer_opportunity_step final" data-selectable-values=\'' + JSON.stringify(selectable_values) + '\'>';
    out[++o] = '<div class="font-montserrat-700 font-size-20 margin-bottom-30">';
    out[++o] = 'Fantastic! ';
    if (selectable_values.length > 1) {
        out[++o] = 'According to your answers, it seems your project taps into one of these consumer opportunities. Select the main one.';
    } else {
        out[++o] = 'According to your answers, it seems your innovation taps into this consumer opportunity.';
    }
    out[++o] = '</div>';
    out[++o] = '<div class="container-selectable-choices">';
    for (var i = 0; i < selectable_values.length; i++) {
        var informations = get_consumer_opportunity_option_by_key(selectable_values[i]);
        if (informations) {
            var selected_classe = (selectable_values.length == 1) ? 'selected' : '';
            out[++o] = '<div class="selectable-choice ' + selected_classe + ' ' + selectable_values[i] + '" data-target="' + informations['value'] + '">';
            out[++o] = '<div class="picture"></div>';
            out[++o] = '<div class="font-montserrat-700 font-size-17 margin-bottom-10">' + informations['libelle'] + '</div>';
            out[++o] = '<div class="description font-work-sans-300 font-size-15">' + informations['description'] + '</div>';
            out[++o] = '<div class="content-bottom">';
            out[++o] = '<div class="informations font-montserrat-700 font-size-15"><span>' + informations['informations'] + '</span></div>';
            out[++o] = '<div class="price-size"></div>';
            out[++o] = '</div>';
            out[++o] = '<div class="triangle-corner"><div class="check"></div></div>';
            out[++o] = '</div>';
        }
    }
    out[++o] = '</div>';
    var class_confirm_button = (selectable_values.length > 1) ? 'disabled' : '';
    out[++o] = '<div class="content-buttons">';
    out[++o] = '<div class="loader-popup">';
    out[++o] = '<div class="loading-spinner"></div>';
    out[++o] = '</div>';
    out[++o] = '<button class="hub-button grey consumer-opportunity-not-sure-selection">Meh, I’m not sure…</button> ';
    out[++o] = ' <button class="hub-button yellow confirm-consumer-opportunity-selection" '+class_confirm_button+'>Confirm</button>';
    out[++o] = '</div>';

    out[++o] = '</div>';
    out[++o] = '</div>';
    return out.join('');
}

function consumerOpportunityGreatStepHtml() {
    var out = [], o = -1;
    out[++o] = '<div class="padding-30 padding-top-0 central-content-846">';
    out[++o] = '<div class="consumer_opportunity_step final">';
    out[++o] = '<div class="font-montserrat-700 font-size-20 margin-bottom-30">';
    out[++o] = 'Great! ';
    out[++o] = 'Your innovation is driven by a tactical opportunity<br>more than a consumer insight. That’s fine too.';
    out[++o] = '</div>';

    out[++o] = '<div class="container-selectable-choices">';
    var informations = get_consumer_opportunity_option_by_key('other');
    if (informations) {
        out[++o] = '<div class="selectable-choice selected other" data-target="8">';
        out[++o] = '<div class="picture"></div>';
        out[++o] = '<div class="font-montserrat-700 font-size-17 margin-bottom-10">' + informations['libelle'] + '</div>';
        out[++o] = '<div class="description font-work-sans-300 font-size-15">' + informations['description'] + '</div>';
        out[++o] = '<div class="triangle-corner"><div class="check"></div></div>';
        out[++o] = '</div>';
    }
    out[++o] = '</div>';
    out[++o] = '<div class="content-buttons">';
    out[++o] = '<div class="info-inner-content-button font-work-sans-400">Meh, I’m not sure…</div>';
    out[++o] = '<div class="loader-popup">';
    out[++o] = '<div class="loading-spinner"></div>';
    out[++o] = '</div>';
    out[++o] = '<button class="hub-button grey reset-consumer-opportunity-selection">Start again</button> ';
    out[++o] = ' <button class="hub-button yellow confirm-consumer-opportunity-selection">Confirm</button>';
    out[++o] = '</div>';

    out[++o] = '</div>';
    out[++o] = '</div>';
    return out.join('');
}

function consumerOpportunityNotSureStepHtml() {
    var out = [], o = -1;
    out[++o] = '<div class="padding-30 padding-top-0 central-content-846">';
    out[++o] = '<div class="consumer_opportunity_step final">';
    out[++o] = '<div class="font-montserrat-700 font-size-20 margin-bottom-30">';
    out[++o] = 'Not quite sure of your choice?! ';
    out[++o] = 'Maybe your innovation is driven by a tactical opportunity more than a consumer insight. That’s okay.';
    out[++o] = '</div>';

    out[++o] = '<div class="container-selectable-choices">';
    var informations = get_consumer_opportunity_option_by_key('other');
    if (informations) {
        out[++o] = '<div class="selectable-choice selected other" data-target="8">';
        out[++o] = '<div class="picture"></div>';
        out[++o] = '<div class="font-montserrat-700 font-size-17 margin-bottom-10">' + informations['libelle'] + '</div>';
        out[++o] = '<div class="description font-work-sans-300 font-size-15">' + informations['description'] + '</div>';
        out[++o] = '<div class="triangle-corner"><div class="check"></div></div>';
        out[++o] = '</div>';
    }
    out[++o] = '</div>';

    out[++o] = '<div class="content-buttons">';
    out[++o] = '<div class="info-inner-content-button font-work-sans-400">If not, why not try our survey again?</div>';
    out[++o] = '<div class="loader-popup">';
    out[++o] = '<div class="loading-spinner"></div>';
    out[++o] = '</div>';
    out[++o] = '<button class="hub-button grey reset-consumer-opportunity-selection">Start again</button> ';
    out[++o] = ' <button class="hub-button yellow confirm-consumer-opportunity-selection">Confirm</button>';
    out[++o] = '</div>'

    out[++o] = '</div>';
    out[++o] = '</div>';
    return out.join('');
}

var consumer_opportunity_steps = {
    1: {
        'mouseflow-key': 'first-choice',
        'question': 'Think of the early adopters for your innovation. What will they think when they see your innovation for the first time?',
        'choices': [
            {
                'key': 'C1-1',
                'text': 'It has a human touch and/or it’s local and/or it’s a small batch',
                'next-step': 2,
                'specific-value': 'human_authenticity',
                'disabled-values': [
                    'shaking_the_codes',
                    'better_for_me',
                    'easy_at_home_everywhere'
                ]
            },
            {
                'key': 'C1-2',
                'text': 'It’s a new take on something familiar',
                'next-step': 2,
                'specific-value': 'shaking_the_codes',
                'disabled-values': [
                    'human_authenticity',
                    'better_for_me',
                    'easy_at_home_everywhere'
                ]
            },
            {
                'key': 'C1-3',
                'next-step': 2,
                'text': 'It’s low or no alcohol and/or low calories and/or made with natural ingredients',
                'specific-value': 'better_for_me',
                'disabled-values': [
                    'human_authenticity',
                    'shaking_the_codes',
                    'easy_at_home_everywhere'
                ]
            },
            {
                'key': 'C1-4',
                'next-step': 2,
                'text': 'It’s convenient',
                'specific-value': 'easy_at_home_everywhere',
                'disabled-values': [
                    'human_authenticity',
                    'shaking_the_codes',
                    'better_for_me'
                ]
            },
            {
                'key': 'C1-5',
                'next-step': 2,
                'text': 'None of these',
                'specific-value': 'other',
                'disabled-values': [
                    'human_authenticity',
                    'easy_at_home_everywhere',
                    'shaking_the_codes',
                    'better_for_me'
                ]
            }
        ]
    },
    2: {
        'mouseflow-key': 'feminine-identity-choice',
        'question': 'Is your innovation specifically designed for women ?',
        'choices': [
            {
                'key': 'C2-1',
                'next-step': 777,
                'text': 'Yes',
                'specific-value': 'feminine_identity',
                'disabled-values': ['power_to_consumers', 'doing_good']
            },
            {
                'key': 'C2-2',
                'next-step': 3,
                'text': 'No',
                'specific-value': null,
                'disabled-values': ['feminine_identity']
            }
        ]
    },
    3: {
        'mouseflow-key': 'doing-good-choice',
        'question': 'Is societal impact (social / environment) the main element of your value proposition?',
        'choices': [
            {
                'key': 'C3-1',
                'next-step': 777,
                'text': 'Yes',
                'specific-value': 'doing_good',
                'disabled-values': ['power_to_consumers', 'feminine_identity']
            },
            {
                'key': 'C3-2',
                'next-step': 4,
                'text': 'No',
                'specific-value': null,
                'disabled-values': ['doing_good']
            }
        ]
    },
    4: {
        'mouseflow-key': 'power-to-consumer-choice',
        'question': 'Is customization or Do-It-Yourself the main element of innovation’s value proposition?',
        'choices': [
            {
                'key': 'C4-1',
                'next-step': 777,
                'text': 'Yes',
                'specific-value': 'power_to_consumers',
                'disabled-values': ['feminine_identity', 'doing_good']
            },
            {
                'key': 'C4-2',
                'next-step': 777,
                'text': 'No',
                'specific-value': null,
                'disabled-values': ['power_to_consumers']
            }
        ]
    }
};

function getReverseSelectionByStep(step) {
    var $modale_main = $('.element-consumer-opportunity-popup .content-modale-main');
    var current_selection = JSON.parse($modale_main.attr('data-selection'));
    switch (step) {
        case 0:
            return [];
        case 1:
            return [];
        case 2:
            for (var i = current_selection.length - 1; i >= 0; i--) {
                if (in_array(current_selection[i], ['feminine_identity', 'doing_good', 'power_to_consumers'])) {
                    current_selection.splice(i, 1);
                }
            }
            return current_selection;
        case 3:
            for (var i = current_selection.length - 1; i >= 0; i--) {
                if (in_array(current_selection[i], ['doing_good', 'power_to_consumers'])) {
                    current_selection.splice(i, 1);
                }
            }
            return current_selection;
        case 4:
            for (var i = current_selection.length - 1; i >= 0; i--) {
                if (current_selection[i] === 'power_to_consumers') {
                    current_selection.splice(i, 1);
                }
            }
            return current_selection;
        default:
            return current_selection;
    }
}

function displayConsumerOpportunityStep(step) {
    var $back_on_popup = $('.element-consumer-opportunity-popup .back-on-popup');
    var $cross_close_popup = $('.element-consumer-opportunity-popup .cross-close-popup');
    var $modale_main = $('.element-consumer-opportunity-popup .content-modale-main');
    if (step === 0) {
        $back_on_popup.hide().attr('data-step', '').removeAttr('data-selectable-values');
        $cross_close_popup.show();
        $modale_main.attr('data-step', 0).attr('data-selection', '[]');
        $modale_main.html(consumerOpportunityStep0Html());
        opti_update_mouseflow('/helper-consumer-opportunity?step=first-page');
    } else if (step === 777) { // plus que 2 choix
        $back_on_popup.show();
        if ($back_on_popup.attr('data-selectable-values') !== undefined) {
            var selectable_values = JSON.parse($back_on_popup.attr('data-selectable-values'));
        } else {
            var selectable_values = [];
            var current_values = JSON.parse($modale_main.attr('data-selection'));
            $('.element-consumer-opportunity-popup .content-opportunity:not(.disabled):not(.no-action)').each(function () {
                if (!in_array($(this).attr('data-target'), current_values)) {
                    selectable_values.push($(this).attr('data-target'));
                }
            });
        }
        if (selectable_values.length == 0) { // L'utilisateur a répondu NON à chaque fois: on affiche la Great page
            $back_on_popup.show();
            $cross_close_popup.hide();
            $modale_main.html(consumerOpportunityGreatStepHtml());
            opti_update_mouseflow('/helper-consumer-opportunity?step=other-choice');
        } else { // On a 1 ou 2 choix possible(s) : on affiche la Fantastic page
            $modale_main.html(consumerOpportunityFantasticStepHtml(selectable_values));
            opti_update_mouseflow('/helper-consumer-opportunity?step=selection-page');
        }
    } else if (step === 999) { // Choix Other
        $back_on_popup.show();
        $cross_close_popup.hide();
        $modale_main.html(consumerOpportunityGreatStepHtml());
        opti_update_mouseflow('/helper-consumer-opportunity?step=other-choice');
    } else {
        $back_on_popup.show();
        $cross_close_popup.hide();
        $modale_main.html(consumerOpportunityOpenStepHtml());
        var selected_step = consumer_opportunity_steps[step];
        if (selected_step) {
            opti_update_mouseflow('/helper-consumer-opportunity?step=' + selected_step['mouseflow-key']);
        }
    }
    $back_on_popup.removeAttr('data-selectable-values');
}

function consumerOpportunityOpenStepHtml() {
    var out = [], o = -1;
    var current_step = parseInt($('.element-consumer-opportunity-popup .content-modale-main').attr('data-step'));
    var step = consumer_opportunity_steps[current_step];
    out[++o] = '<div class="padding-30 padding-top-0 central-content-846">';
    out[++o] = '<div class="consumer_opportunity_step">';
    out[++o] = '<div class="font-montserrat-700 margin-bottom-30 font-size-20">';
    out[++o] = step['question'];
    out[++o] = '</div>';
    out[++o] = '<div class="container-center-choices">';
    out[++o] = '<div class="container-choices">';
    for (var i = 0; i < step['choices'].length; i++) {
        out[++o] = '<div class="choice" id="choice-' + step['choices'][i]['key'] + '" data-next-step="' + step['choices'][i]['next-step'] + '" data-key="' + step['choices'][i]['key'] + '" data-values=\'' + JSON.stringify(step['choices'][i]['disabled-values']) + '\'>';
        out[++o] = '<div class="fake-radio"></div>';
        out[++o] = '<div class="text font-work-sans-300">' + step['choices'][i]['text'] + '</div>';
        out[++o] = '</div>';
    }
    out[++o] = '</div>';
    out[++o] = '</div>';

    out[++o] = '</div>';
    out[++o] = '</div>';
    out[++o] = consumerOpportunityFooterHtml();
    return out.join('');
}

/**
 * get_consumer_opportunity_option_by_key
 * @param key
 * @returns {*}
 */
function get_consumer_opportunity_option_by_key(key) {
    for (var i = 0; i < consumer_opportunities_options.length; i++) {
        if (consumer_opportunities_options[i]['key'] == key) {
            return consumer_opportunities_options[i];
        }
    }
    return null;
}
var consumer_opportunities_options = [
    {
        'key': 'human_authenticity',
        'value': 1,
        'classes': 'human_authenticity',
        'libelle': 'HUMAN AUTHENTICITY',
        'description': 'Connect whit the real people and stories behind products, search for modern craftsmanship',
        'informations': 'Craft in the spirits industry'
    },
    {
        'key': 'easy_at_home_everywhere',
        'value': 2,
        'classes': 'easy_at_home_everywhere',
        'libelle': 'EASY AT HOME & EVERYWHERE',
        'description': 'Convenience culture: seamless, personalised service as the default consumer experience',
        'informations': 'Convenience<br>Catering<br>Delivery @ home'
    },
    {
        'key': 'shaking_the_codes',
        'value': 3,
        'classes': 'shaking_the_codes',
        'libelle': 'SHAKING THE CODES',
        'description': 'Seeking a new take on something familiar, new tastes discovery and multi-sensorial experiences',
        'informations': 'Flavours & new origins<br>Experience beyond product'
    },
    {
        'key': 'power_to_consumers',
        'value': 4,
        'classes': 'power_to_consumers',
        'libelle': 'POWER TO CONSUMERS',
        'description': 'A new breed of entrepreneurs seek experimental, open, and collaborative connections to contribute, not just consumer',
        'informations': 'Personalisation<br>Customisation<br>Crowdsourcing<br>DIY'
    },
    {
        'key': 'feminine_identity',
        'value': 5,
        'classes': 'feminine_identity',
        'libelle': 'FEMININE IDENTITY',
        'description': 'Thinking beyond traditional silos to recognise the fluidity of identity, especially gender.',
        'informations': 'Women alcohol<br>Consumption<br>Growth rate'
    },
    {
        'key': 'doing_good',
        'value': 6,
        'classes': 'doing_good',
        'libelle': 'DOING GOOD',
        'description': 'Quest for purposeful lifestyles, long view consumption, positive societal impact',
        'informations': 'Social entrepreneurs<br>Activism<br>Upcycling'
    },
    {
        'key': 'better_for_me',
        'value': 7,
        'classes': 'better_for_me',
        'libelle': 'BETTER FOR ME',
        'description': 'A search for balance, healthier options and self-optimisations, harnessing nature, science, spirituality and technology',
        'informations': 'Natural<br>Organic<br>No/Low alc.'
    },
    {
        'key': 'other',
        'value': 8,
        'classes': 'tactical_innovation no-action',
        'libelle': 'TACTICAL INNOVATION',
        'description': 'Projects based only on business insights, with no consumer opportunity behind',
        'informations': ''
    }
];

function consumerOpportunityFooterHtml() {
    var out = [], o = -1;
    var disabled_values = JSON.parse($('.element-consumer-opportunity-popup .content-modale-main').attr('data-selection'));
    out[++o] = '<div class="background-color-f2f2f2 padding-30 text-align-center">';
    for (var i = 0; i < consumer_opportunities_options.length; i++) {
        var classe_disabled = (disabled_values.length == 0 || !in_array(consumer_opportunities_options[i]['key'], disabled_values)) ? '' : 'disabled';
        out[++o] = '<div class="content-opportunity ' + consumer_opportunities_options[i]['classes'] + ' ' + classe_disabled + '" data-target="' + consumer_opportunities_options[i]['key'] + '"><div class="picture icon '+consumer_opportunities_options[i]['classes']+'"></div><div class="libelle font-montserrat-700">' + consumer_opportunities_options[i]['libelle'] + '</div></div>';
    }
    out[++o] = '</div>';
    return out.join('');
}

$(document).ready(function () {

    $(document).on('click', '.consumer_opportunity_action_begin', function (e) {
        e.stopPropagation();
        $('.element-consumer-opportunity-popup .back-on-popup').attr('data-step', 0).removeAttr('data-selectable-values').show();
        $('.element-consumer-opportunity-popup .cross-close-popup').hide();
        $('.element-consumer-opportunity-popup .content-modale-main').attr('data-step', 1).html(consumerOpportunityOpenStepHtml());
        opti_update_mouseflow('/helper-consumer-opportunity?step=first-choice');
        return false;
    });

    $(document).on('click', '.element-consumer-opportunity-popup .choice', function (e) {
        e.stopPropagation();
        var $modale_main = $('.element-consumer-opportunity-popup .content-modale-main');
        var $back_on_popup = $('.element-consumer-opportunity-popup .back-on-popup');
        var $celui = $(this);
        var next_step = parseInt($celui.attr('data-next-step'));
        var current_step = parseInt($modale_main.attr('data-step'));
        var values = JSON.parse($celui.attr('data-values'));
        var current_values = JSON.parse($modale_main.attr('data-selection'));
        var selection = arrayUnique(current_values.concat(values));
        $back_on_popup.attr('data-step', current_step).removeAttr('data-selectable-values');
        $modale_main.attr('data-step', next_step).attr('data-selection', JSON.stringify(selection));
        if (next_step == 777) {
            $back_on_popup.attr('data-old-step', current_step);
        } else {
            $back_on_popup.removeAttr('data-old-step');
        }
        displayConsumerOpportunityStep(next_step);
        return false;
    });

    $(document).on('click', '.element-consumer-opportunity-popup .content-opportunity', function (e) {
        e.stopPropagation();
        var $celui = $(this);
        var target = $celui.attr('data-target');
        var data = get_detail_consumer_opportunity_by_key(target);
        var $back_on_popup = $('.element-consumer-opportunity-popup .back-on-popup');
        var $cross_close_popup = $('.element-consumer-opportunity-popup .cross-close-popup');
        var $modale_main = $('.element-consumer-opportunity-popup .content-modale-main');
        var $modale_detail = $('.element-consumer-opportunity-popup .content-modale-detail');
        if (data) {
            // SET DATA
            $modale_detail.removeClass(getAllConsumerOpportunitiesClasses()).addClass(target);
            $('.element-consumer-opportunity-popup  .main-title').html(data['title']);
            $('.content-modale-detail .text-center').html(data['text-center']);
            $('.content-modale-detail .bandeau-picture .block-left-1').html(data['block-left-1']);
            if (!data['block-left-2']) {
                $('.content-modale-detail .bandeau-picture .block-left-2').hide()
            } else {
                $('.content-modale-detail .bandeau-picture .block-left-2').show().html(data['block-left-2']);
            }
            $('.content-modale-detail .block-opportunityoutlook-1 .title').html(data['block-opportunityoutlook-1-title']);
            $('.content-modale-detail .block-opportunityoutlook-2 .title').html(data['block-opportunityoutlook-2-title']);
            $('.content-modale-detail .block-opportunityoutlook-3 .title').html(data['block-opportunityoutlook-3-title']);
            $('.content-modale-detail .citation').html(data['citation']);
            $('.content-modale-detail .content-block-business .block-business-1 .text').html(data['block-business-1-text']);
            $('.content-modale-detail .content-block-business .block-business-2 .text').html(data['block-business-2-text']);
            $('.content-modale-detail .content-block-business .block-business-3 .text').html(data['block-business-3-text']);

            // Show infos
            $modale_main.slideToggle(120);
            $modale_detail.slideToggle(120);
            $back_on_popup.show();
            $cross_close_popup.hide();
        }
    });

    $(document).on('click', '.container-selectable-choices .selectable-choice:not(.selected)', function (e) {
        e.stopPropagation();
        if(!$('.custom-content-popup.opened').hasClass('loading')){
            $('.container-selectable-choices .selectable-choice').removeClass('selected');
            $(this).addClass('selected');
            $('.confirm-consumer-opportunity-selection').prop("disabled", false);
        }
    });
    $(document).on('click', '.reset-consumer-opportunity-selection', function (e) {
        e.stopPropagation();
        if (!$('.confirm-consumer-opportunity-selection').hasClass('loading')) {
            var $back_on_popup = $('.element-consumer-opportunity-popup .back-on-popup');
            var $cross_close_popup = $('.element-consumer-opportunity-popup .cross-close-popup');
            var $modale_main = $('.element-consumer-opportunity-popup .content-modale-main');
            $back_on_popup.hide().attr('data-step', '');
            $cross_close_popup.show();
            $modale_main.attr('data-step', 0).attr('data-selection', '[]').html(consumerOpportunityStep0Html());
        }
    });

    $(document).on('click', '.confirm-consumer-opportunity-selection', function (e) {
        e.stopPropagation();

        if (!$(this).is(':disabled') && !$('.custom-content-popup.opened').hasClass('loading')) {
            var consumer_value = $('.selectable-choice.selected').attr('data-target');
            if (!consumer_value) {
                return;
            }
            enable_load_popup();
            var id = $('#detail-id-innovation').val();
            var key = "consumer_opportunity";
            var request_data = {id: id, name: key, value: consumer_value};
            explore_update_inline_quarterly_data(request_data, key);
        }
    });

    $(document).on('click', '.consumer-opportunity-not-sure-selection', function (e) {
        e.stopPropagation();
        if (!$('.custom-content-popup.opened').hasClass('loading')) {
            var $back_on_popup = $('.element-consumer-opportunity-popup .back-on-popup');
            var $modale_main = $('.element-consumer-opportunity-popup .content-modale-main');
            var selectable_values = $('.element-consumer-opportunity-popup .consumer_opportunity_step.final').attr('data-selectable-values');
            $back_on_popup.attr('data-step', 777).attr('data-selectable-values', selectable_values);
            $modale_main.attr('data-step', 888).html(consumerOpportunityNotSureStepHtml());
        }
    });
});